<html>
<head>
<script>

function posToAngle( pos ) {
	return pos*2.0*Math.PI-Math.PI/2.0;
}

var tCos60 = new Array(60), tSin60 = new Array(60);
for( var i = 0; i < 60; ++i ) {
	var a = posToAngle( i/60.0 );
	tCos60[i] = Math.cos(a);
	tSin60[i] = Math.sin(a);
}

function circle( ctx, x, y, r ) {
	ctx.beginPath();
	ctx.arc( x, y, r, 0, 2*Math.PI );
}

function Clock( canvas ) {

	this.canvas = canvas;
	this.tNow = new Date();
	this.keepGoing = true;

	this.onTimer = function() {
		if( this.keepGoing ) {
			this.tNow = new Date();
			this.Draw();
			setTimeout( this.onTimer.bind(this), 1000 - (new Date()).getMilliseconds() );
		}
	};
	
	this.Start = function() {
		this.onTimer();
	};
	
	this.Stop = function() {
		this.keepGoing = false;
	}
		
	this.OnSize = function() {
		this.Draw();
	};
		
	this.Draw = function() {
		if( document.hidden )
			return;
		
		var t = this.tCur || new Date();
		var width = this.canvas.width;
		var height = this.canvas.height-1;
		var middle = Math.min(width, height) / 2;
		var radius = middle * 0.9;
		var xCenter = width/2, yCenter = height/2;
		
		var ctx = this.canvas.getContext("2d");
		
		var backcolor = '#FFFFFF';
		ctx.fillStyle = backcolor;
		ctx.clearRect( 0, 0, this.canvas.width, this.canvas.height );
		
		var rOutside = radius * 0.98;
		var rOutTicks = rOutside;
		var rInMinuteTicks = rOutTicks * 0.95;
		var rInHourTicks = rOutTicks * 0.9;
		var rHour = radius * 0.6;
		var rMinute = (rInMinuteTicks + rInHourTicks) / 2;
		var rSecond = rMinute;
		var rBack = -radius * 0.1;
		var rDot = rSecond * 0.85;
		var dotSize = rDot * 0.08;

		var wMinuteTicks = radius * 0.03;
		var wHourTicks = wMinuteTicks * 2.0;
		
		var wHourHand = wHourTicks * 1.5;
		var wMinuteHand = wHourTicks;
		var wSecondHand = wMinuteHand / 2.0;
		
		//--------------------------------------------------------------
		// Draw the metal ring
		//
		var r = radius * 1.0/0.9;
		
		var rg = ctx.createRadialGradient(
			xCenter, yCenter - r, 0.0,
			xCenter, yCenter - r, r * 2
		);
		rg.addColorStop( 0, '#FFFFFF' );
		rg.addColorStop( 1, '#212121' );
		ctx.fillStyle = rg;

		circle( ctx, xCenter, yCenter, r );
		ctx.fill()
		
		var rSmaller = r * 0.90;
		
		var rg = ctx.createRadialGradient(
			xCenter, yCenter + rSmaller, 0.0,
			xCenter, yCenter + rSmaller, rSmaller * 2
		);
		rg.addColorStop( 0, '#FFFFFF' );
		rg.addColorStop( 1, '#212121' );
		ctx.fillStyle = rg;
		circle( ctx, xCenter, yCenter, rSmaller )
		ctx.fill();
		
		//--------------------------------------------------------------
		// Draw the clock face.
		//
		var rg = ctx.createRadialGradient(
			xCenter, yCenter-radius*0.6, 0.0,
			xCenter, yCenter, rOutside
		);
		rg.addColorStop( 0, '#FCFCFC' );
		rg.addColorStop( 1, '#DCDCDC' );
		ctx.fillStyle = rg;
		circle( ctx, xCenter, yCenter, rOutside );
		ctx.fill();

		ctx.strokeStyle = '#000000';
		ctx.lineCap = 'butt';
		ctx.lineWidth = wMinuteTicks;
		ctx.beginPath();
		for( var i = 1; i < 60; ++i ) {
			if( i % 5 ) {
				ctx.moveTo( xCenter + rInMinuteTicks * tCos60[i], yCenter + rInMinuteTicks * tSin60[i] );
				ctx.lineTo( xCenter + rOutTicks * tCos60[i], yCenter + rOutTicks * tSin60[i] );
			}
		}
		ctx.stroke();
		
		ctx.lineWidth = wHourTicks;
		ctx.beginPath();
		for( var i = 0; i < 60; i += 5 ) {
			ctx.moveTo( xCenter + rInHourTicks * tCos60[i], yCenter + rInHourTicks * tSin60[i] );
			ctx.lineTo( xCenter + rOutTicks * tCos60[i], yCenter + rOutTicks * tSin60[i] );
		}
		ctx.stroke();
			
		//--------------------------------------------------------------
		// Draw the digital clock.
		//
		var textHeight = Math.max(1,radius*0.37);
		ctx.font = textHeight + 'px Arial';
		ctx.fillStyle = '#646464';
		ctx.textAlign = 'end';
		ctx.textBaseline = 'alphabetic';
		var tStr = t.getHours() + ':' + ('0' + t.getMinutes()).slice(-2) + ':' + ('0' + t.getSeconds()).slice(-2);
		var w = ctx.measureText( '00:00:00' ).width;
		ctx.fillText( tStr, xCenter+w/2, yCenter+radius/2-textHeight/8 );
		
		ctx.fillStyle = '#8C8C8C';
		ctx.font = textHeight/3.5 + 'px Arial';
		ctx.textAlign = 'center';
		ctx.textBaseline = 'top';
		ctx.fillText( 'CrossMgr', xCenter, yCenter-rInHourTicks/2 );
		
		//--------------------------------------------------------------
		// Draw the hands.
		//
		var secondPos = (t.getSeconds() + t.getMilliseconds()/1000.0) / 60.0;
		var minutePos = (t.getMinutes() + secondPos) / 60.0;
		var hourPos = (t.getHours() % 12 + minutePos) / 12.0;
		
		ctx.lineCap = 'round';
		ctx.strokeStyle = 'rgba(0,0,180,0.5)';
		ctx.lineWidth = wHourHand;
		var a = posToAngle( hourPos );
		var cosCur = Math.cos(a), sinCur = Math.sin(a);
		ctx.beginPath();
		ctx.moveTo( xCenter + rBack * cosCur, yCenter + rBack * sinCur );
		ctx.lineTo( xCenter + rHour * cosCur, yCenter + rHour * sinCur );
		ctx.stroke();
		
		ctx.strokeStyle = 'rgba(0,150,0,0.5)';
		ctx.lineWidth = wMinuteHand;
		var a = posToAngle( minutePos );
		var cosCur = Math.cos(a), sinCur = Math.sin(a);
		ctx.beginPath();
		ctx.moveTo( xCenter + rBack * cosCur,   yCenter + rBack * sinCur );
		ctx.lineTo( xCenter + rMinute * cosCur, yCenter + rMinute * sinCur );
		ctx.stroke();
		
		ctx.strokeStyle = '#FF0000';
		ctx.fillStyle = '#FF0000';
		ctx.lineWidth = wSecondHand;
		var a = posToAngle( secondPos );
		var cosCur = Math.cos(a), sinCur = Math.sin(a);
		var xDot = xCenter + rDot * cosCur;
		var yDot = yCenter + rDot * sinCur;
		ctx.beginPath();
		ctx.moveTo( xDot, yDot );
		ctx.lineTo( xCenter + rMinute * cosCur, yCenter + rMinute * sinCur );
		ctx.stroke();
		circle( ctx, xDot, yDot, dotSize );
		ctx.fill();
	};
}

function onLoad() {
	clock = new Clock( document.getElementById('myCanvas') );
	clock.Start();
}

</script>
</head>
<body onload="onLoad()">
<canvas id="myCanvas" width="500" height="500"></canvas>
</body>
</html>
